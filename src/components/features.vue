<template>
  <section id="section6">
    <div id="features-container" class="fixed-container">
      <div class="svg-container">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 900">
          <defs>
            <clipPath id="featuresSnake">
              <rect
                id="featuresSnakeRect"
                y="121"
                fill="#6E6E6E"
                width="1440"
                height="118"
                x="245.65310492505364"
              ></rect>
            </clipPath>
          </defs>

          <!-- TITLE -->
          <g>
            <path
              d="M1021.65,163.25h-20.4v8.6h19.2V186h-19.2v18.2h-18V149h38.4v14.2h0Z"
              transform="translate(-1 0)"
              fill="#fff"
            ></path>
            <path
              d="M1069.25,204.25h-40V149h39.2v14.2h-21.2v6h20v14.2h-20v6.4h22v14.4Z"
              transform="translate(-1 0)"
              fill="#fff"
            ></path>
            <path
              d="M1131.25,204.25h-19.6l-2.2-7.8h-15.8l-2.1,7.8h-18.7l19.2-55.2h20Zm-25.5-21.6-4.1-14.8-4.1,14.8h8.2Z"
              transform="translate(-1 0)"
              fill="#fff"
            ></path>
            <path
              d="M1169.35,163h-13v41.1h-18.1V163h-13V149h44.1v14Z"
              transform="translate(-1 0)"
              fill="#fff"
            ></path>
            <path
              d="M1225.35,180.65c0,8.8-2,14-6,18s-10.4,6.5-19.2,6.5-15.2-2.5-19.2-6.5-6-9.2-6-18V149h18.2v32.4c0,3.3.6,4.8,1.8,6a7.76,7.76,0,0,0,10.4,0c1.2-1.2,1.8-2.8,1.8-6V149h18.2v31.6Z"
              transform="translate(-1 0)"
              fill="#fff"
            ></path>
            <path
              d="M1285,204.25h-20.8l-8.8-18.4h-2.3v18.4H1235V149h24c6.8,0,12,1.2,16,4a16.29,16.29,0,0,1,6.8,13.6c0,11.2-6.8,15.2-9.2,16.6Zm-23.5-40.6a6.44,6.44,0,0,0-4-1h-4.6v9.6h4.6a6.24,6.24,0,0,0,4-1,3.93,3.93,0,0,0,2-3.8A4.11,4.11,0,0,0,1261.45,163.65Z"
              transform="translate(-1 0)"
              fill="#fff"
            ></path>
            <path
              d="M1329.75,204.25h-40V149H1329v14.2h-21.2v6h20v14.2h-20v6.4h22v14.4Z"
              transform="translate(-1 0)"
              fill="#fff"
            ></path>
            <path
              d="M1371.75,200.45c-4.4,3.4-9.9,4.7-16.3,4.7a35,35,0,0,1-21.3-7.4l8-13.6c5.1,4.3,12.3,6,14.7,6s4.1-.7,4.1-2.3-2-2.2-4-2.9-6.4-2-8-2.6a24,24,0,0,1-7.6-4.1c-2.8-2.4-5-5.8-5-11.8a17.6,17.6,0,0,1,6.4-13.4c3.4-2.8,8.9-4.8,16.2-4.8s14.9,2.6,19.7,6.6l-6.9,12.8a22.77,22.77,0,0,0-13.1-5.3c-2.9,0-4.5.6-4.5,2.2s2.6,2.2,3.8,2.6l6.6,2c1.9,0.6,6.4,2.2,9.2,4.6a15.1,15.1,0,0,1,5.2,12A18.33,18.33,0,0,1,1371.75,200.45Z"
              transform="translate(-1 0)"
              fill="#fff"
            ></path>
          </g>

          <!-- title path -->
          <!-- BASE -->
          <path
            fill="none"
            stroke="#4c6e75"
            stroke-width="10"
            d="M1440,174.1h-44.4"
          ></path>
          <path
            fill="none"
            stroke="#4c6e75"
            stroke-width="10"
            d="M957.6,174.1H1"
          ></path>
          <!-- <circle fill="#4c6e75" cx="718.2" cy="173.8" r="9.3"></circle>
          <circle fill="#4c6e75" cx="478.8" cy="173.8" r="9.3"></circle>
          <circle fill="#4c6e75" cx="239.4" cy="173.8" r="9.3"></circle> -->

          <!-- MASK -->
          <g>
            <path
              id="svg_10a"
              fill="none"
              stroke="#27363b"
              stroke-width="10"
              d="M1440,174.1h-44.4"
            ></path>
            <path
              id="svg_10b"
              fill="none"
              stroke="#27363b"
              stroke-width="10"
              d="M957.6,174.1H1"
            ></path>
            <!-- <circle
              id="svg_10c"
              fill="none"
              stroke="#27363b"
              stroke-width="10"
              cx="718.2"
              cy="173.8"
              r="9.3"
            ></circle>
            <circle
              id="svg_10d"
              fill="none"
              stroke="#27363b"
              stroke-width="10"
              cx="478.8"
              cy="173.8"
              r="9.3"
            ></circle>
            <circle
              id="svg_10e"
              fill="none"
              stroke="#27363b"
              stroke-width="10"
              cx="239.4"
              cy="173.8"
              r="9.3"
            ></circle> -->
          </g>
        </svg>

        <svg
          id="product-computer"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 1440 900"
        >
          <defs>
            <clipPath id="featuresImage">
              <path
                fill="#888888"
                d="M202.5,347h618c3.3,0,6,2.7,6,6v337c0,3.3-2.7,6-6,6h-618c-3.3,0-6-2.7-6-6V353C196.5,349.7,199.2,347,202.5,347z"
              ></path>
            </clipPath>
          </defs>

          <g style="clip-path: url(#featuresImage);">
            <g
              class="featureImgContainer"
              style="transform: translate3d(0px, 348px, 0px);"
            >
              >
              <image
                id="svg_img1"
                width="1210"
                height="790"
                href="../assets/images/features/dashboard.jpg"
                transform="matrix(0.4955 0 0 0.4955 195 347.6465)"
              ></image>
              <image
                width="1210"
                height="790"
                href="../assets/images/features/efficiency.jpg"
                transform="matrix(0.4955 0 0 0.4955 195 697)"
              ></image>
              <image
                width="1210"
                height="790"
                href="../assets/images/features/statistics.jpg"
                transform="matrix(0.4955 0 0 0.4955 195 1047.3535)"
              ></image>
              <image
                width="1210"
                height="790"
                href="../assets/images/features/conversion.jpg"
                transform="matrix(0.4955 0 0 0.4955 195 1397.707)"
              ></image>
            </g>
          </g>

          <path
            class="computer"
            id="svg_11"
            fill="none"
            stroke="#FFF"
            stroke-width="6"
            d="M856,726c0,22.1-17.9,40-40,40H175c-22.1,0-40-17.9-40-40H856z M558,728c0,22.1-27.9,20-50,20h-18 c-22.1,0-50,2.1-50-20 M187,317h618c11,0,20,9,20,20v369c0,11-9,20-20,20H187c-11,0-20-9-20-20V337C167,326,176,317,187,317z M203,347h586c3.3,0,6,2.7,6,6v337c0,3.3-2.7,6-6,6H203c-3.3,0-6-2.7-6-6V353C197,349.7,199.7,347,203,347z"
          ></path>
        </svg>
      </div>

      <div class="slides txt-white">
        <span class="counter"> {{ this.screenNo }} / 4 </span>
        <div class="slide">
          <h3></h3>
          <p>asad</p>
        </div>
      </div>
    </div>
  </section>
</template>

<script>
import { mapGetters, mapActions } from "vuex";

export default {
  name: "Features",
  data() {
    return {
      svg10a: 0,
      svg10b: 0,
      // svg10c: 0,
      // svg10d: 0,
      // svg10e: 0,
      initial: 0,
      screenNo: 1
    };
  },
  computed: mapGetters([
    "docHeightPerc",
    "sectionsEndingPerc",
    "sectionsClientHeight"
  ]),
  methods: {
    ...mapActions(["getDocumentHeightPercentage", "getSectionsClientHeight"]),

    //event on scroll
    handleScroll() {
      this.getDocumentHeightPercentage();
      let start = this.sectionsEndingPerc.section5;

      // handling section2 scroll starts
      if (this.docHeightPerc < start) {
        document.querySelector(".fixed-container").style.position = "relative";
      } else if (this.docHeightPerc >= start) {
        document.querySelector(".fixed-container").style.position = "fixed";
        document.querySelector(
          ".fixed-container"
        ).style.transform = `translateY(0px)`;
      }

      let allSectionsHeightInPx =
        this.sectionsClientHeight.section6 +
        this.sectionsClientHeight.section5 +
        this.sectionsClientHeight.section4 +
        this.sectionsClientHeight.section3 +
        this.sectionsClientHeight.section2 +
        this.sectionsClientHeight.section1;

      if (window.scrollY >= allSectionsHeightInPx) {
        document.querySelector(
          ".fixed-container"
        ).style.transform = `translateY(${(window.scrollY -
          allSectionsHeightInPx) *
          -1}px)`;
      }
      // handling section2 scroll ends

      //svg handle starts
      if (this.docHeightPerc < start) {
        this.unFill([this.svg10a, this.svg10b, this.svg11]);
      }
      if (this.docHeightPerc >= start) {
        if (this.docHeightPerc <= start + 3) {
          this.drawPath(this.svg10a, start, start + 3);
        }

        if (this.docHeightPerc <= start + 20) {
          this.drawPath(this.svg11, start, start + 20);
          this.unFill([this.svg10b]);
        }
      }

      if (this.docHeightPerc <= start + 8) {
        document.querySelector(".featureImgContainer").style.transform =
          "translate3d(0px, 348px, 0px)";

        document.querySelector(".slides").style.opacity = "0";
      }

      if (this.docHeightPerc > start + 8 && this.docHeightPerc <= start + 25) {
        this.drawPath(this.svg10b, start + 8, start + 25);
        document.querySelector(".featureImgContainer").style.transform =
          "translate3d(0px, 0px, 0px)";
        this.fill([this.svg10a, this.svg11]);

        document.querySelector(".slides").style.opacity = "1";

        this.screenNo = 1;
        document.querySelector(".slide h3").innerHTML = "the dashboard";
        document.querySelector(".slide p").innerHTML =
          "The dashboard is your one-stop for information in Serio Verify. Costs, activities and key performance indicators are consolidated in a single screen, giving you an executive overview of your entire value chain.";

        if (this.docHeightPerc >= start + 12.25) {
          document.querySelector(".featureImgContainer").style.transform =
            "translate3d(0px, -348px, 0px)";

          document.querySelector(".slides").style.opacity = "2";

          this.screenNo = 2;
          document.querySelector(".slide h3").innerHTML = "effeciency";
          document.querySelector(".slide p").innerHTML =
            "Get insights into cost per new customer across multiple traffic sources and call centers.";
        }
        if (this.docHeightPerc >= start + 16.5) {
          document.querySelector(".featureImgContainer").style.transform =
            "translate3d(0px, -700px, 0px)";

          this.screenNo = 3;
          document.querySelector(".slide h3").innerHTML = "statistic";
          document.querySelector(".slide p").innerHTML =
            "Monitor your data cleansing and see trends for flows of interested consumers.";
        }
        if (this.docHeightPerc >= start + 20.5) {
          document.querySelector(".featureImgContainer").style.transform =
            "translate3d(0px, -1050px, 0px)";

          this.screenNo = 4;
          document.querySelector(".slide h3").innerHTML = "conversion";
          document.querySelector(".slide p").innerHTML =
            "Get insights into cost per new customer across multiple traffic sources and call centers.";
        }
      }
    },

    //draw line
    drawPath(el, startPerc = 0, endPerc, sign = 1) {
      var drawLen = 0;
      var pathLen = el.getTotalLength();
      var scrollPerc = (this.docHeightPerc - startPerc) / (endPerc - startPerc);
      drawLen = pathLen - pathLen * scrollPerc;
      el.setAttribute("stroke-dashoffset", sign * drawLen);
    },

    //unfill path
    unFill(els) {
      els.forEach(el => {
        el.setAttribute("stroke-dashoffset", el.getTotalLength());
      });
    },

    //fill path
    fill(els) {
      els.forEach(el => {
        el.setAttribute("stroke-dashoffset", 0);
      });
    },

    //set offset and dasharray to full length
    setDashArrayAndOffset(els) {
      els.forEach(el => {
        el.setAttribute("stroke-dasharray", el.getTotalLength());
        el.setAttribute("stroke-dashoffset", el.getTotalLength());
      });
    }
  },
  mounted() {
    this.getDocumentHeightPercentage();
    window.addEventListener("scroll", this.handleScroll);

    this.svg10a = document.querySelector("#svg_10a");
    this.svg10b = document.querySelector("#svg_10b");
    this.svg11 = document.querySelector("#svg_11");

    this.setDashArrayAndOffset([this.svg10a, this.svg10b, this.svg11]);

    this.getSectionsClientHeight({
      sectionId: "section6",
      sectionClientHeight: document.querySelector("#section6").offsetHeight
    });
  },
  destroyed() {
    window.removeEventListener("scroll", this.handleScroll);
  }
};
</script>

<style lang="scss">
#section6 {
  cursor: default;
  font: 100%/1.5 sans-serif;
  text-rendering: optimizeLegibility;
  font-family: grad, serif;
  color: #18252a;
  box-sizing: inherit;
  font-size: inherit;
  line-height: inherit;
  border-style: solid;
  border-width: 0;
  background-repeat: no-repeat;
  margin: 0;
  padding: 0;
  z-index: 2;
  position: relative;
  height: 1100vh;
  width: 100%;
  bottom: 0;
  background-color: #557c83;

  .fixed-container {
    top: 0;
    z-index: 10000;
    height: 100vh;
    background-color: #557c83;
    width: 100%;
    transform: translateY(0px);
  }

  #product-computer {
    position: absolute;
    height: 100vh;
    width: 100vw;
    left: 0;
    top: -5vh;
  }

  .featureImgContainer {
    transition: transform 0.5s ease;
  }

  .slides {
    position: absolute;
    max-width: 450px;
    width: 26%;
    left: 68.5%;
    top: 33%;
    color: #fff;
    opacity: 0;
    transition: opacity 1s ease;

    .counter {
      font-size: 1.4vw;
    }

    .slide {
      h3 {
        font-size: 1.7vw !important;
        line-height: 1.4vw !important;
        font-size: 14px;
        line-height: 16px;
        padding: 20px 0;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-family: canada-type-gibson, sans-serif;
        font-weight: 700;
      }

      p {
        font-size: 1.6vw !important;
        line-height: 2vw !important;
        letter-spacing: 1px;
        font-family: grad, serif;
      }
    }
  }
}
</style>