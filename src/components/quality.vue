<template>
  <section id="section4">
    <div class="txt3 visible">
      <h3>Cheaper &amp; better leads</h3>
      <p>
        By washing and enriching your inside sales leads in real time you only
        pay and process what is appropriate for your particular business.
      </p>
    </div>

    <svg
      version="1.1"
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      viewBox="0 0 1440 900"
    >
      <!--BASE GFX-->
      <!-- layer 1 -->
      <!-- quality starts -->
      <g fill="#233034">
        <path
          d="M398,529.2l-10.8,9.6l-6.7-7.4c-3.9,1.6-8.5,2.4-13.3,2.4c-17.2,0-30-10.5-30-28.5c0-18,12.8-28.6,30-28.6s30,10.6,30,28.6c0,7-1.9,12.7-5.2,17.2L398,529.2z M367.2,492c-7.2,0-11.8,5.3-11.8,12.9s4.6,12.9,11.8,12.9c0.8,0,1.1-0.1,1.1-0.1l-1.5-1.7
						l10.8-9.6l1.2,1.4c0,0,0.2-1.3,0.2-2.9C379,497.3,374.4,492,367.2,492z"
        ></path>
        <path
          d="M454.8,509.2c0,8.8-2,14-6,18s-10.4,6.5-19.2,6.5c-8.8,0-15.2-2.5-19.2-6.5s-6-9.2-6-18v-31.6h18.2V510
						c0,3.3,0.6,4.8,1.8,6s2.8,2,5.2,2s4-0.8,5.2-2s1.8-2.8,1.8-6v-32.4h18.2V509.2z"
        ></path>
        <path
          d="M516,532.8h-19.6l-2.2-7.8h-15.8l-2.1,7.8h-18.8l19.2-55.2h20L516,532.8z M490.5,511.2l-4.1-14.8l-4.1,14.8H490.5z"
        ></path>
        <path d="M558,532.8h-36.8v-55.2h18V518H558V532.8z"></path>
        <path d="M582.9,532.8h-18.1v-55.2h18.1V532.8z"></path>
        <path d="M633,491.7h-13v41.1h-18.1v-41.1h-13v-14.1H633V491.7z"></path>
        <path
          d="M689.8,477.6l-19.2,33.6v21.6h-18.1v-21.6l-19.1-33.6h20l8.2,18.6l8.2-18.6H689.8z"
        ></path>
      </g>
      <!-- quality ends -->
      <path
        fill="none"
        stroke="#233034"
        stroke-width="10"
        d="M321,511 167,511 167,237 2,237 "
      ></path>
      <path
        fill="none"
        class="mobile-hidden"
        stroke="#233034"
        stroke-width="10"
        d="M809,900 809,854 914,854 914,511 695,511"
      ></path>

      <!--MASKED GFX-->
      <!-- layer 2 -->
      <g style="clip-path: url(/#qualityClipTop);">
        <path
          id="svg_6a"
          fill="none"
          stroke="#3aafa9"
          stroke-width="10"
          d="M321,511 167,511 167,237 2,237 "
        ></path>
        <path
          id="svg_6b"
          fill="none"
          stroke="#3aafa9"
          stroke-width="10"
          d="M809,910 809,854 914,854 914,511 695,511"
        ></path>
        <!-- quality starts -->
        <g fill="none" stroke-width="5" stroke="#3aafa9">
          <path
            id="svg_7a"
            d="M398,529.2l-10.8,9.6l-6.7-7.4c-3.9,1.6-8.5,2.4-13.3,2.4c-17.2,0-30-10.5-30-28.5c0-18,12.8-28.6,30-28.6s30,10.6,30,28.6
						c0,7-1.9,12.7-5.2,17.2L398,529.2z M367.2,492c-7.2,0-11.8,5.3-11.8,12.9s4.6,12.9,11.8,12.9c0.8,0,1.1-0.1,1.1-0.1l-1.5-1.7
						l10.8-9.6l1.2,1.4c0,0,0.2-1.3,0.2-2.9C379,497.3,374.4,492,367.2,492z"
          ></path>
          <path
            id="svg_7b"
            d="M454.8,509.2c0,8.8-2,14-6,18s-10.4,6.5-19.2,6.5c-8.8,0-15.2-2.5-19.2-6.5s-6-9.2-6-18v-31.6h18.2V510
						c0,3.3,0.6,4.8,1.8,6s2.8,2,5.2,2s4-0.8,5.2-2s1.8-2.8,1.8-6v-32.4h18.2V509.2z"
          ></path>
          <path
            id="svg_7c"
            d="M516,532.8h-19.6l-2.2-7.8h-15.8l-2.1,7.8h-18.8l19.2-55.2h20L516,532.8z M490.5,511.2l-4.1-14.8l-4.1,14.8H490.5z"
          ></path>
          <path id="svg_7d" d="M558,532.8h-36.8v-55.2h18V518H558V532.8z"></path>
          <path id="svg_7e" d="M582.9,532.8h-18.1v-55.2h18.1V532.8z"></path>
          <path
            id="svg_7f"
            d="M633,491.7h-13v41.1h-18.1v-41.1h-13v-14.1H633V491.7z"
          ></path>
          <path
            id="svg_7g"
            d="M689.8,477.6l-19.2,33.6v21.6h-18.1v-21.6l-19.1-33.6h20l8.2,18.6l8.2-18.6H689.8z"
          ></path>
        </g>
        <!-- quality ends -->
      </g>
    </svg>
  </section>
</template>

<script>
import { mapGetters, mapActions } from "vuex";

export default {
  name: "Quality",
  data() {
    return {
      svg6a: 0,
      svg6b: 0,
      svg7a: 0,
      svg7b: 0,
      svg7c: 0,
      svg7d: 0,
      svg7e: 0,
      svg7f: 0,
      svg7g: 0
    };
  },
  computed: mapGetters(["docHeightPerc", "sectionsEndingPerc"]),
  methods: {
    ...mapActions(["getDocumentHeightPercentage"]),

    //event on scroll
    handleScroll() {
      this.getDocumentHeightPercentage();
      let start = this.sectionsEndingPerc.section2 + 8.5;

      if (this.docHeightPerc < start) {
        this.unFill([
          this.svg6a,
          this.svg6b,
          this.svg7a,
          this.svg7b,
          this.svg7c,
          this.svg7d,
          this.svg7e,
          this.svg7f,
          this.svg7g
        ]);
      } else if (
        this.docHeightPerc >= start &&
        this.docHeightPerc <= start + 3
      ) {
        this.drawPath(this.svg6a, start, start + 3, -1);
        // document.querySelector(".txt3").style.opacity = "0";
        this.unFill([
          this.svg6b,
          this.svg7a,
          this.svg7b,
          this.svg7c,
          this.svg7d,
          this.svg7e,
          this.svg7f,
          this.svg7g
        ]);
      } else if (
        this.docHeightPerc >= start + 3 &&
        this.docHeightPerc <= start + 4.4
      ) {
        document.querySelector(".txt3").style.opacity = "1";
        if (
          this.docHeightPerc >= start + 3 &&
          this.docHeightPerc < start + 3.2
        ) {
          this.drawPath(this.svg7a, start + 3, start + 3.2);
          this.fill([this.svg6a]);
          this.unFill([
            this.svg6b,
            this.svg7b,
            this.svg7c,
            this.svg7d,
            this.svg7e,
            this.svg7f,
            this.svg7g
          ]);
        } else if (
          this.docHeightPerc >= start + 3.2 &&
          this.docHeightPerc < start + 3.4
        ) {
          this.drawPath(this.svg7b, start + 3.2, start + 3.4);
          this.fill([this.svg6a, this.svg7a]);
          this.unFill([
            this.svg6b,
            this.svg7c,
            this.svg7d,
            this.svg7e,
            this.svg7f,
            this.svg7g
          ]);
        } else if (
          this.docHeightPerc >= start + 3.4 &&
          this.docHeightPerc < start + 3.6
        ) {
          this.drawPath(this.svg7c, start + 3.4, start + 3.6);
          this.fill([this.svg6a, this.svg7a, this.svg7b]);
          this.unFill([
            this.svg6b,
            this.svg7d,
            this.svg7e,
            this.svg7f,
            this.svg7g
          ]);
        } else if (
          this.docHeightPerc >= start + 3.6 &&
          this.docHeightPerc <= start + 3.8
        ) {
          this.drawPath(this.svg7d, start + 3.6, start + 3.8);
          this.fill([this.svg6a, this.svg7a, this.svg7b, this.svg7c]);
          this.unFill([this.svg6b, this.svg7e, this.svg7f, this.svg7g]);
        } else if (
          this.docHeightPerc >= start + 3.8 &&
          this.docHeightPerc <= start + 4
        ) {
          this.drawPath(this.svg7e, start + 3.8, start + 4);
          this.fill([
            this.svg6a,
            this.svg7a,
            this.svg7b,
            this.svg7c,
            this.svg7d
          ]);
          this.unFill([this.svg6b, this.svg7f, this.svg7g]);
        } else if (
          this.docHeightPerc >= start + 4 &&
          this.docHeightPerc <= start + 4.2
        ) {
          this.drawPath(this.svg7f, start + 4, start + 4.2);
          this.fill([
            this.svg6a,
            this.svg7a,
            this.svg7b,
            this.svg7c,
            this.svg7d,
            this.svg7e
          ]);
          this.unFill([this.svg6b, this.svg7g]);
        } else if (
          this.docHeightPerc >= start + 4.2 &&
          this.docHeightPerc <= start + 4.4
        ) {
          this.drawPath(this.svg7g, start + 4.2, start + 4.4);
          this.fill([
            this.svg6a,
            this.svg7a,
            this.svg7b,
            this.svg7c,
            this.svg7d,
            this.svg7e,
            this.svg7f
          ]);
          this.unFill([this.svg6b]);
        }
      } else if (
        this.docHeightPerc >= start + 4.5 &&
        this.docHeightPerc < start + 11.2
      ) {
        this.drawPath(this.svg6b, start + 4.5, start + 11.2, -1);
        this.fill([
          this.svg6a,
          this.svg7a,
          this.svg7b,
          this.svg7c,
          this.svg7d,
          this.svg7e,
          this.svg7f,
          this.svg7g
        ]);
      } else if (this.docHeightPerc > start + 11.2) {
        this.fill([
          this.svg6a,
          this.svg6b,
          this.svg7a,
          this.svg7b,
          this.svg7c,
          this.svg7d,
          this.svg7e,
          this.svg7f,
          this.svg7g
        ]);
      }
    },

    //draw line
    drawPath(el, startPerc = 0, endPerc, sign = 1) {
      var drawLen = 0;
      var pathLen = el.getTotalLength();
      var scrollPerc = (this.docHeightPerc - startPerc) / (endPerc - startPerc);
      drawLen = pathLen - pathLen * scrollPerc;
      el.setAttribute("stroke-dashoffset", sign * drawLen);
    },

    //unfill path
    unFill(els) {
      els.forEach(el => {
        el.setAttribute("stroke-dashoffset", el.getTotalLength());
      });
    },

    //fill path
    fill(els) {
      els.forEach(el => {
        el.setAttribute("stroke-dashoffset", 0);
      });
    },
    setDashArrayAndOffset(els) {
      els.forEach(el => {
        el.setAttribute("stroke-dasharray", el.getTotalLength());
        el.setAttribute("stroke-dashoffset", el.getTotalLength());
      });
    }
  },
  mounted() {
    this.getDocumentHeightPercentage();
    window.addEventListener("scroll", this.handleScroll);

    this.svg6a = document.querySelector("#svg_6a");
    this.svg6b = document.querySelector("#svg_6b");
    this.svg7a = document.querySelector("#svg_7a");
    this.svg7b = document.querySelector("#svg_7b");
    this.svg7c = document.querySelector("#svg_7c");
    this.svg7d = document.querySelector("#svg_7d");
    this.svg7e = document.querySelector("#svg_7e");
    this.svg7f = document.querySelector("#svg_7f");
    this.svg7g = document.querySelector("#svg_7g");

    this.setDashArrayAndOffset([
      this.svg6a,
      this.svg6b,
      this.svg7a,
      this.svg7b,
      this.svg7c,
      this.svg7d,
      this.svg7e,
      this.svg7f,
      this.svg7g
    ]);
  },
  destroyed() {
    window.removeEventListener("scroll", this.handleScroll);
  }
};
</script>

<style lang="scss">
#section4 {
  position: relative;
  height: 125.5vh;
  width: 100%;
  bottom: 0;
  background-color: #27353a;

  .txt3.visible {
    // opacity: 1;
    color: #fff;
  }
  .txt3 {
    width: 100%;
    font-size: 20px;
    line-height: 34px;
    position: absolute;
    opacity: 0;
    transition: all 0.3s ease;
    top: 62%;
    left: 24%;
    width: 25%;

    h3 {
      font-size: 14px;
      line-height: 16px;
      padding-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-family: canada-type-gibson, sans-serif;
      font-weight: 700;
    }

    p {
      font-size: 25px;
      line-height: 30px;
      letter-spacing: 1px;
      font-family: grad, serif;
    }
  }
}
</style>