<template>
  <section id="section7">
    <div class="track-fixed-container">
      <div class="svg-container">
        <div class="txt txt-center txt-white see-video">
          <p>See video</p>
        </div>
        <!-- <div class="buttons txt-center">
          <a class="btn-nav txt-white" data-ng-click="cc.playDanish()">Dansk</a>
          <a class="btn-nav txt-white" data-ng-click="cc.playEnglish()"
            >English</a
          >
        </div> -->

        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="svg-route"
          viewBox="0 0 1440 900"
        >
          <!-- BASE -->
          <g fill="none" stroke="#6e7075" stroke-width="10">
            <path d="M656,452H112v449"></path>
            <circle cx="720.8" cy="450.8" r="65.2"></circle>
            <line x1="1440" y1="452" x2="1182" y2="452"></line>
            <line x1="920" y1="452" x2="786" y2="452"></line>
          </g>

          <!-- MASKED -->
          <g stroke="#FFF" stroke-width="10" fill="none">
            <line id="svg_11a" x1="1440" y1="452" x2="1182" y2="452"></line>
            <line id="svg_11b" x1="920" y1="452" x2="786" y2="452"></line>
            <circle id="svg11c_i" cx="720.8" cy="450.8" r="65.2"></circle>
            <circle id="svg11c_ii" cx="720.8" cy="450.8" r="65.2"></circle>
            <path id="svg_11d" d="M656,452H112v449"></path>

            <path
              stroke-width="6"
              id="svg_11e"
              d="M710,437.5 734.5,452 712,466 712,446 "
            ></path>
          </g>
          <!-- <g stroke="#FFF">
            <path fill="none" stroke-width="10" d="M656,452H112v449"></path>
            <path fill="none" stroke-width="10" d="M960,452H786"></path>
          </g> -->

          <g fill="#FFF">
            <path
              d="M961.4,454.9c-2.9,2.3-6.8,3.2-11.1,3.2H946v12.4h-13.1v-39.9h17.4c4.3,0,8.2,0.9,11.1,3.2
	c2.9,2.3,4.5,5.8,4.5,10.6C965.9,449.2,964.3,452.6,961.4,454.9z M951.3,441.2c-0.9-0.6-1.7-0.8-3.2-0.8h-2.1v7.8h2.1
	c1.4,0,2.3-0.1,3.2-0.7c0.9-0.6,1.4-1.6,1.4-3.2C952.7,442.8,952.1,441.8,951.3,441.2z"
            ></path>
            <path
              d="M1006.7,470.6h-15.1l-6.4-13.3h-1.7v13.3h-13.1v-39.9h17.4c4.9,0,8.7,0.9,11.6,2.9c2.9,2,4.9,5.5,4.9,9.8
	c0,8.1-4.9,11-6.7,12L1006.7,470.6z M989.8,441.2c-0.6-0.5-1.4-0.8-2.9-0.8h-3.3v6.9h3.3c1.4,0,2.4-0.3,2.9-0.7
	c0.6-0.5,1.4-1,1.4-2.8C991.2,442.2,990.3,441.6,989.8,441.2z"
            ></path>
            <path
              d="M1030.2,471.3c-12.4,0-21.7-7.6-21.7-20.6s9.3-20.7,21.7-20.7c12.4,0,21.7,7.6,21.7,20.7
	S1042.6,471.3,1030.2,471.3z M1030.2,441c-5.2,0-8.6,3.8-8.6,9.3c0,5.5,3.4,9.3,8.6,9.3s8.5-3.8,8.5-9.3
	C1038.7,444.9,1035.4,441,1030.2,441z"
            ></path>
            <path
              d="M1095.3,430.6l-15.1,39.9h-12.7l-15.1-39.9h13.9l7.5,23.2l7.5-23.2H1095.3z"
            ></path>
            <path
              d="M1128,470.6h-28.9v-39.9h28.4v10.3h-15.3v4.3h14.5v10.2h-14.5v4.6h15.9V470.6z"
            ></path>
            <path
              d="M1172.3,470.6h-13.6l-12.2-22.3c0,0,0.3,4.3,0.3,7.2v15.1h-12.7v-39.9h14.2l11.6,22.3c0,0-0.3-4.3-0.3-7.2
	v-15.1h12.7V470.6z"
            ></path>
            <path
              d="M961.9,491.5h-9.4v29.8h-13.1v-29.8H930v-10.2h31.9V491.5z"
            ></path>
            <path
              d="M1002.4,521.2h-15.1l-6.4-13.3h-1.7v13.3h-13.1v-39.9h17.4c4.9,0,8.7,0.9,11.6,2.9c2.9,2,4.9,5.5,4.9,9.8
	c0,8.1-4.9,11-6.7,12L1002.4,521.2z M985.5,491.9c-0.6-0.5-1.4-0.8-2.9-0.8h-3.3v6.9h3.3c1.4,0,2.4-0.3,2.9-0.7
	c0.6-0.5,1.4-1,1.4-2.8C986.9,492.9,986,492.3,985.5,491.9z"
            ></path>
            <path
              d="M1044.7,521.2h-14.2l-1.6-5.6h-11.4l-1.5,5.6h-13.6l13.9-39.9h14.5L1044.7,521.2z M1026.2,505.6l-3-10.7
	l-3,10.7H1026.2z"
            ></path>
            <path
              d="M1081.2,516.9c-1.4,1.4-5.5,5-14.2,5c-11.9,0-21.4-7.3-21.4-20.6c0-13.3,9.6-20.6,21.4-20.6
	c9,0,13.3,3.8,13.3,3.8l-3.5,11c0,0-4.1-3.5-9-3.5c-4.9,0-9.1,2.9-9.1,9.1c0,6.2,4.5,9,9.1,9c4.6,0,7.8-1.9,9.6-3.6L1081.2,516.9z"
            ></path>
            <path
              d="M1123.1,521.2h-15.6l-6.7-13.3l-2.3,2.9v10.4h-13v-39.9h13v12.2l8.4-12.2h15.3l-12.9,16.1L1123.1,521.2z"
            ></path>
            <path
              d="M1176.5,521.2h-15.1l-6.4-13.3h-1.7v13.3h-13.1v-39.9h17.4c4.9,0,8.7,0.9,11.6,2.9c2.9,2,4.9,5.5,4.9,9.8
	c0,8.1-4.9,11-6.7,12L1176.5,521.2z M1159.5,491.9c-0.6-0.5-1.4-0.8-2.9-0.8h-3.3v6.9h3.3c1.4,0,2.4-0.3,2.9-0.7
	c0.6-0.5,1.4-1,1.4-2.8C1161,492.9,1160.1,492.3,1159.5,491.9z"
            ></path>
            <path
              d="M1208.9,521.2H1180v-39.9h28.4v10.3H1193v4.3h14.5v10.2H1193v4.6h15.9V521.2z"
            ></path>
            <path
              d="M1248.9,516.9c-1.4,1.4-5.5,5-14.2,5c-11.9,0-21.4-7.3-21.4-20.6c0-13.3,9.6-20.6,21.4-20.6
	c9,0,13.3,3.8,13.3,3.8l-3.5,11c0,0-4.1-3.5-9-3.5c-4.9,0-9.1,2.9-9.1,9.1c0,6.2,4.5,9,9.1,9c4.6,0,7.8-1.9,9.6-3.6L1248.9,516.9z"
            ></path>
            <path
              d="M1272,521.9c-12.4,0-21.7-7.6-21.7-20.6c0-13,9.3-20.7,21.7-20.7c12.4,0,21.7,7.6,21.7,20.7
	C1293.7,514.3,1284.5,521.9,1272,521.9z M1272,491.7c-5.2,0-8.6,3.8-8.6,9.3c0,5.5,3.4,9.3,8.6,9.3c5.2,0,8.5-3.8,8.5-9.3
	C1280.5,495.5,1277.2,491.7,1272,491.7z"
            ></path>
            <path
              d="M1335.4,521.2h-15.1l-6.4-13.3h-1.7v13.3h-13.1v-39.9h17.4c4.9,0,8.7,0.9,11.6,2.9c2.9,2,4.9,5.5,4.9,9.8
	c0,8.1-4.9,11-6.7,12L1335.4,521.2z M1318.5,491.9c-0.6-0.5-1.4-0.8-2.9-0.8h-3.3v6.9h3.3c1.4,0,2.4-0.3,2.9-0.7
	c0.6-0.5,1.4-1,1.4-2.8C1319.9,492.9,1319,492.3,1318.5,491.9z"
            ></path>
            <path
              d="M1369.9,516.9c-3.8,2.9-9,4.3-15.9,4.3h-15.1v-39.9h15.1c6.9,0,12.2,1.4,15.9,4.3c3.8,2.9,6.7,7.5,6.7,15.6
	S1373.6,514,1369.9,516.9z M1361,494c-1.2-1.2-3.2-2-6.1-2h-3v18.2h3c2.9,0,4.9-0.9,6.1-2c1.2-1.2,2.3-2.9,2.3-6.9
	C1363.3,497.2,1362.2,495.2,1361,494z"
            ></path>
          </g>
        </svg>
      </div>
    </div>
  </section>
</template>

<script>
import { mapGetters, mapActions } from "vuex";

export default {
  name: "Features",
  data() {
    return {
      svg11a: 0,
      svg11b: 0,
      svg11c_i: 0,
      svg11d: 0,
      svg11e: 0
    };
  },
  computed: mapGetters([
    "docHeightPerc",
    "sectionsEndingPerc",
    "sectionsClientHeight"
  ]),
  methods: {
    ...mapActions([
      "getDocumentHeightPercentage",
      "getSectionsClientHeight",
      "fillStroke",
      "unfillStroke",
      "setDashArrayAndOffset"
    ]),

    //event on scroll
    handleScroll() {
      this.getDocumentHeightPercentage();
      let start = this.sectionsEndingPerc.section6;

      // handling section2 scroll starts
      if (this.docHeightPerc < start) {
        document.querySelector(".track-fixed-container").style.position =
          "relative";
      } else if (this.docHeightPerc >= start) {
        document.querySelector(".track-fixed-container").style.position =
          "fixed";
        document.querySelector(
          ".track-fixed-container"
        ).style.transform = `translateY(0px)`;
      }

      let allSectionsHeightInPx =
        this.sectionsClientHeight.section7 -
        (document.querySelector(".track-fixed-container").clientHeight + 500) +
        this.sectionsClientHeight.section6 +
        this.sectionsClientHeight.section5 +
        this.sectionsClientHeight.section4 +
        this.sectionsClientHeight.section3 +
        this.sectionsClientHeight.section2 +
        this.sectionsClientHeight.section1;

      if (window.scrollY >= allSectionsHeightInPx) {
        document.querySelector(
          ".track-fixed-container"
        ).style.transform = `translateY(${(window.scrollY -
          allSectionsHeightInPx) *
          -1}px)`;
      }

      // handling section2 scroll ends
      //svg handle starts
      if (this.docHeightPerc < start) {
        this.unfillStroke([
          this.svg11a,
          this.svg11b,
          this.svg11c_i,
          this.svg11c_ii,
          this.svg11d,
          this.svg11e
        ]);
      }
      if (this.docHeightPerc >= start) {
        if (this.docHeightPerc <= start + 3) {
          this.drawPath(this.svg11a, start, start + 3);
          this.unfillStroke([
            this.svg11b,
            this.svg11c_i,
            this.svg11c_ii,
            this.svg11d,
            this.svg11e
          ]);
        }

        if (this.docHeightPerc > start + 3 && this.docHeightPerc <= start + 6) {
          this.drawPath(this.svg11b, start + 3, start + 6);
          document.querySelector(".see-video").style.opacity = "0";
          this.fillStroke([this.svg11a]);
          this.unfillStroke([
            this.svg11c_i,
            this.svg11c_ii,
            this.svg11d,
            this.svg11e
          ]);
        }

        if (this.docHeightPerc > start + 6 && this.docHeightPerc <= start + 9) {
          this.drawPath(this.svg11c_i, start + 6, start + 9);
          this.drawPath(this.svg11c_ii, start + 6, start + 9, -1);

          document.querySelector(".see-video").style.opacity = "1";

          if (this.docHeightPerc > start + 7.5) {
            this.drawPath(this.svg11e, start + 7.5, start + 9);
          }

          this.fillStroke([this.svg11a, this.svg11b]);
          this.unfillStroke([this.svg11d]);
        }

        if (
          this.docHeightPerc > start + 9 &&
          this.docHeightPerc <= start + 12
        ) {
          this.drawPath(this.svg11d, start + 9, start + 12);
          this.fillStroke([
            this.svg11a,
            this.svg11b,
            this.svg11c_i,
            this.svg11c_ii,
            this.svg11e
          ]);
        }

        if (this.docHeightPerc > start + 12) {
          this.fillStroke([
            this.svg11a,
            this.svg11b,
            this.svg11c_i,
            this.svg11c_ii,
            this.svg11d,
            this.svg11e
          ]);
        }
      }
    },

    //draw line
    drawPath(el, startPerc = 0, endPerc, sign = 1) {
      var drawLen = 0;
      var pathLen = el.getTotalLength();
      var scrollPerc = (this.docHeightPerc - startPerc) / (endPerc - startPerc);
      drawLen = pathLen - pathLen * scrollPerc;
      el.setAttribute("stroke-dashoffset", sign * drawLen);
    }
  },
  mounted() {
    this.getDocumentHeightPercentage();
    window.addEventListener("scroll", this.handleScroll);

    this.svg11a = document.querySelector("#svg_11a");
    this.svg11b = document.querySelector("#svg_11b");
    this.svg11c_i = document.querySelector("#svg11c_i");
    this.svg11c_ii = document.querySelector("#svg11c_ii");
    this.svg11d = document.querySelector("#svg_11d");
    this.svg11e = document.querySelector("#svg_11e");

    this.setDashArrayAndOffset([
      this.svg11a,
      this.svg11b,
      this.svg11c_i,
      this.svg11c_ii,
      this.svg11d,
      this.svg11e
    ]);

    this.getSectionsClientHeight({
      sectionId: "section7",
      sectionClientHeight: document.querySelector("#section7").offsetHeight
    });
  },
  destroyed() {
    window.removeEventListener("scroll", this.handleScroll);
  }
};
</script>

<style lang="scss">
#section7 {
  position: relative;
  cursor: default;
  font: 100%/1.5 sans-serif;
  text-rendering: optimizeLegibility;
  font-family: grad, serif;
  color: #111;
  box-sizing: inherit;
  font-size: inherit;
  line-height: inherit;
  border-style: solid;
  border-width: 0;
  background-repeat: no-repeat;
  margin: 0;
  padding: 0;
  z-index: 2;
  position: relative;
  height: 638vh;
  width: 100%;
  bottom: 0;
  //   background-color: pink;

  .track-fixed-container {
    z-index: 10000;
    height: 102vh;
    width: 100%;
    left: 0;
    top: 0;
    transform: translateY(0px);
    position: relative;
    background-image: url("../assets/images/track/lines.gif");
    background-repeat: repeat;

    &::after {
      content: "";
      background-image: url("../assets/images/track/vid-placeholder.jpg");
      background-position: center;
      background-repeat: no-repeat;
      background-size: cover;
      opacity: 0.5;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      position: absolute;
      z-index: -100;
    }
    .txt {
      position: absolute;
      top: 76%;
      left: 50.5%;
      -webkit-transform: translateX(-50%);
      transform: translateX(-50%);
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s ease;
      z-index: 7;
      color: #fff;

      p {
        font-size: 32px;
        font-weight: 700;
        font-family: canada-type-gibson, sans-serif;
        text-transform: uppercase;
        letter-spacing: 1.5px;
      }
    }
  }

  .svg-container {
    position: absolute;
    height: 100vh;
    width: 100vw;
    left: 0;
    top: -24.5vh;
  }
}
</style>